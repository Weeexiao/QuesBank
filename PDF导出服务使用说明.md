# QuesBank PDF导出服务使用说明

## 概述

本服务使用Node.js + PDFKit技术栈，提供稳定可靠的PDF导出功能，支持中文字体和专业试卷排版。

## 系统要求

- Node.js 14.0 或更高版本
- Windows 10/11 或 Linux/macOS
- 网络连接（用于安装依赖包）

## 安装步骤

### 1. 安装Node.js
1. 访问 https://nodejs.org/
2. 下载并安装LTS版本
3. 验证安装：打开命令行，输入 `node --version`

### 2. 启动PDF服务
**方法一：使用启动脚本（推荐）**
- 双击运行 `启动PDF服务.bat`
- 脚本会自动检查环境和安装依赖

**方法二：手动启动**
```bash
# 安装依赖
npm install

# 启动服务
npm start
```

### 3. 添加中文字体（可选）
1. 创建 `fonts` 目录
2. 将中文字体文件（如SimSun.ttf）放入fonts目录
3. 支持的字体格式：TTF

## 使用方法

### 1. 启动服务
- 运行启动脚本或手动启动
- 服务将在 http://localhost:3000 运行
- 看到"PDF服务已启动"提示即表示成功

### 2. 导出PDF
1. 打开题库管理页面
2. 点击任意题库的"导出试卷"按钮
3. 选择PDF格式
4. 设置试卷选项
5. 点击导出

### 3. 服务状态检查
访问 http://localhost:3000/api/health 检查服务状态

## 功能特点

### PDF生成特性
- ✅ A4纸张格式
- ✅ 中文字体支持
- ✅ 专业试卷排版
- ✅ 自动分页
- ✅ 页码显示
- ✅ 题型标识
- ✅ 答案和解析选项

### 试卷内容
- 📝 试卷标题和基本信息
- 👤 考生信息填写区域
- 📋 题目自动编号
- 🔤 选择题A、B、C、D选项
- 📝 填空题下划线区域
- ✅ 判断题选择框
- 💡 答案和解析（可选）

## 故障排除

### 常见问题

**1. 服务启动失败**
- 检查Node.js是否正确安装
- 检查端口3000是否被占用
- 查看错误日志

**2. PDF导出失败**
- 确保PDF服务正在运行
- 检查浏览器控制台错误信息
- 确认题库数据格式正确

**3. 中文显示乱码**
- 确保fonts目录中有中文字体文件
- 检查字体文件格式是否为TTF
- 重启服务

**4. 依赖安装失败**
- 检查网络连接
- 尝试使用国内npm镜像：`npm config set registry https://registry.npmmirror.com`
- 清除npm缓存：`npm cache clean --force`

### 日志查看
服务运行时会显示详细日志，包括：
- 服务启动信息
- PDF生成请求
- 错误信息

## 技术架构

### 后端技术栈
- **Express.js**: Web框架
- **PDFKit**: PDF生成库
- **CORS**: 跨域支持

### API接口
- `POST /api/generate-pdf`: PDF生成接口
- `GET /api/health`: 健康检查接口

### 数据格式
```json
{
  "bank": {
    "id": "题库ID",
    "name": "题库名称",
    "questions": [...]
  },
  "title": "试卷标题",
  "includeAnswer": true,
  "includeExplanation": true
}
```

## 性能优化

- 流式PDF生成，支持大文件
- 内存优化，避免内存泄漏
- 错误处理和恢复机制
- 支持并发请求

## 安全考虑

- CORS配置限制
- 请求大小限制
- 输入数据验证
- 错误信息过滤

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基本PDF导出功能
- 中文字体支持
- 专业试卷排版 